<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>John Ruben Solutions - Food Tracker</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, query, where, onSnapshot, deleteDoc, doc, setDoc, getDoc, orderBy, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        
        const firebaseConfig = {
            apiKey: "AIzaSyD2h_sejv6lB8sFC15xHSgqxfdD2hLd5Kg",
            authDomain: "john-ruben-solutions.firebaseapp.com",
            projectId: "john-ruben-solutions",
            storageBucket: "john-ruben-solutions.firebasestorage.app",
            messagingSenderId: "761855596159",
            appId: "1:761855596159:web:a4bbe805663c2304c5d14a",
            measurementId: "G-1T2J8VR066"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        
        // Expose to Global Window for React
        window.fb = { 
            auth, db, 
            signInWithEmailAndPassword, createUserWithEmailAndPassword, 
            onAuthStateChanged, signOut, 
            collection, addDoc, query, where, onSnapshot, deleteDoc, doc, setDoc, getDoc, orderBy, serverTimestamp 
        };
    </script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: { navy: '#0f172a', dark: '#020617', card: '#1e293b', green: '#84cc16', teal: '#22d3ee', input: '#334155' }
                    },
                    fontFamily: { sans: ['"Plus Jakarta Sans"', 'sans-serif'] }
                }
            }
        }
    </script>
    <style> 
        body { background-color: #0f172a; color: #f8fafc; } 
        #reader video { object-fit: cover; border-radius: 12px; }
        /* Scrollbar */
        .dropdown-scroll::-webkit-scrollbar { width: 4px; }
        .dropdown-scroll::-webkit-scrollbar-track { background: #334155; }
        .dropdown-scroll::-webkit-scrollbar-thumb { background: #84cc16; border-radius: 3px; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        const API_KEY = '4FRpc4urF9W2UedPH6agara8y52PR0efkZRmoPvv'; 
        
        const AuthScreen = () => {
            const [isRegister, setIsRegister] = useState(false);
            const [email, setEmail] = useState("");
            const [password, setPassword] = useState("");
            const [error, setError] = useState("");
            
            const handleSubmit = async (e) => {
                e.preventDefault();
                setError("");
                if(!window.fb) { setError("Firebase not loaded. Refresh page."); return; }
                try {
                    if (isRegister) await window.fb.createUserWithEmailAndPassword(window.fb.auth, email, password);
                    else await window.fb.signInWithEmailAndPassword(window.fb.auth, email, password);
                } catch (err) { setError(err.message); }
            };
            return (
                <div className="min-h-screen flex items-center justify-center p-4">
                    <div className="bg-brand-card p-8 rounded-3xl w-full max-w-sm border border-slate-700">
                        <h2 className="text-xl font-bold text-white mb-6 text-center">{isRegister ? "Create Account" : "Tracker Login"}</h2>
                        <form onSubmit={handleSubmit}>
                            <input type="email" placeholder="Email" className="w-full p-3 mb-4 bg-brand-input rounded-xl text-white outline-none focus:border-brand-green border border-transparent" value={email} onChange={e=>setEmail(e.target.value)} />
                            <input type="password" placeholder="Password" className="w-full p-3 mb-6 bg-brand-input rounded-xl text-white outline-none focus:border-brand-green border border-transparent" value={password} onChange={e=>setPassword(e.target.value)} />
                            {error && <p className="text-red-500 text-xs mb-4 text-center">{error}</p>}
                            <button type="submit" className="w-full py-3 bg-brand-green text-brand-navy font-bold rounded-xl">{isRegister ? "Sign Up" : "Log In"} </button>
                        </form>
                        <button onClick={()=>setIsRegister(!isRegister)} className="w-full mt-4 text-xs text-slate-400 hover:text-white underline">{isRegister ? "Already have an account? Log In" : "Need account? Sign Up"}</button>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [user, setUser] = useState(null);
            const [targets, setTargets] = useState(null);
            const [query, setQuery] = useState("");
            const [resultsList, setResultsList] = useState([]); // Fixed Variable Name
            const [currentDate, setCurrentDate] = useState(new Date().toISOString().split('T')[0]);
            const [log, setLog] = useState([]);
            const [dailyWeight, setDailyWeight] = useState("");
            
            // Selection & Adjustment
            const [selectedFood, setSelectedFood] = useState(null);
            const [displayAmount, setDisplayAmount] = useState(100);
            const [measureUnit, setMeasureUnit] = useState('g');
            
            const [isScanning, setIsScanning] = useState(false);
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState("");
            const scannerRef = useRef(null);

            // 1. Auth Listener
            useEffect(() => {
                const checkFb = setInterval(() => {
                    if (window.fb) {
                        clearInterval(checkFb);
                        window.fb.onAuthStateChanged(window.fb.auth, (u) => {
                            setUser(u);
                            if (u) loadTargets(u.uid);
                        });
                    }
                }, 500);
                return () => clearInterval(checkFb);
            }, []);

            // 2. Fetch Data (Log + Weight)
            useEffect(() => {
                if (!user || !window.fb) return;
                
                // Fetch Log
                const q = window.fb.query(window.fb.collection(window.fb.db, "users", user.uid, "logs"), window.fb.where("date", "==", currentDate));
                const unsub = window.fb.onSnapshot(q, (snap) => {
                    const rawLogs = snap.docs.map(d => ({ id: d.id, ...d.data() }));
                    // Client side sort to avoid Firestore index requirement
                    rawLogs.sort((a,b) => (b.createdAt?.seconds || 0) - (a.createdAt?.seconds || 0));
                    setLog(rawLogs);
                });
                
                // Fetch Weight
                const fetchWeight = async () => {
                    const docRef = window.fb.doc(window.fb.db, "users", user.uid, "daily_stats", currentDate);
                    const docSnap = await window.fb.getDoc(docRef);
                    setDailyWeight(docSnap.exists() ? docSnap.data().weight : "");
                };
                fetchWeight();
                return () => unsub();
            }, [user, currentDate]);

            const loadTargets = async (uid) => {
                const docRef = window.fb.doc(window.fb.db, "users", uid, "data", "targets");
                const snap = await window.fb.getDoc(docRef);
                if (snap.exists()) setTargets(snap.data());
            };

            const saveWeight = async () => {
                if (!user) return;
                await window.fb.setDoc(window.fb.doc(window.fb.db, "users", user.uid, "daily_stats", currentDate), { weight: dailyWeight, date: currentDate }, { merge: true });
            };

            // 3. Search Logic
            const parseInput = (inputString) => {
                const weightRegex = /(\d+(\.\d+)?)\s*(g|gram|grams)\b/i;
                const match = inputString.match(weightRegex);
                let detectedWeight = null;
                let cleanTerm = inputString;
                if (match) {
                    detectedWeight = parseFloat(match[1]);
                    cleanTerm = inputString.replace(match[0], '').trim();
                }
                cleanTerm = cleanTerm.replace(/^\s*[-,\.]+\s*/, '').trim();
                return { term: cleanTerm, weight: detectedWeight };
            };

            const handleSearch = async (e, overrideQuery = null) => {
                if (e) e.preventDefault();
                const qRaw = overrideQuery || query;
                if (!qRaw) return;

                const { term, weight } = parseInput(qRaw);
                const startGrams = weight || 100;
                
                setLoading(true); setError(""); setSelectedFood(null); setResultsList([]);
                
                // Barcode
                if (/^\d+$/.test(term)) {
                    try {
                        let res = await fetch(`https://api.nal.usda.gov/fdc/v1/foods/search?api_key=${API_KEY}&query=${term}&pageSize=1&dataType=Branded,SR Legacy`);
                        let data = await res.json();
                        if (data.foods && data.foods.length > 0) {
                            selectFood(data.foods[0], startGrams);
                            setLoading(false);
                            return;
                        } 
                        // Fallback OpenFoodFacts
                        res = await fetch(`https://world.openfoodfacts.org/api/v0/product/${term}.json`);
                        data = await res.json();
                        if(data.status === 1) {
                             const p = data.product;
                             const n = p.nutriments;
                             const item = {
                                name: p.product_name || "Unknown Product",
                                calories: n['energy-kcal_100g'] || 0,
                                protein: n.proteins_100g || 0,
                                carbs: n.carbohydrates_100g || 0,
                                fat: n.fat_100g || 0,
                                userGrams: startGrams,
                                dataType: 'OpenFoodFacts'
                             };
                             setSelectedFood(item);
                             setMeasureUnit('g'); setDisplayAmount(startGrams);
                             setQuery("");
                             setLoading(false);
                             return;
                        }
                    } catch (err) { console.error(err); }
                }

                // Text Search
                try {
                    const res = await fetch(`https://api.nal.usda.gov/fdc/v1/foods/search?api_key=${API_KEY}&query=${term}&pageSize=10&dataType=Foundation,SR Legacy,Branded`);
                    const data = await res.json();
                    if(data.foods && data.foods.length > 0) {
                        setResultsList(data.foods);
                    } else {
                        setError("No results found.");
                    }
                } catch (err) { setError("Error fetching foods."); }
                setLoading(false);
            };

            const selectFood = async (food, grams = 100) => {
                if (food.dataType === 'OpenFoodFacts') return; // Handled in search

                setLoading(true);
                try {
                    const detailRes = await fetch(`https://api.nal.usda.gov/fdc/v1/food/${food.fdcId}?api_key=${API_KEY}`);
                    const detail = await detailRes.json();
                    
                    const getN = (id) => {
                        const n = detail.foodNutrients.find(x => (x.nutrient?.id === id || x.nutrientId === id));
                        return n ? (n.amount || n.value) : 0;
                    };

                    const item = {
                        name: detail.description,
                        calories: getN(1008) || getN(208),
                        protein: getN(1003) || getN(203),
                        carbs: getN(1005) || getN(205),
                        fat: getN(1004) || getN(204),
                        userGrams: grams
                    };

                    setSelectedFood(item);
                    setResultsList([]); 
                    setQuery("");
                    setMeasureUnit('g'); 
                    setDisplayAmount(grams);
                } catch(e) { setError("Details failed load"); }
                setLoading(false);
            };

            // 4. Staging Adjustment
            const updateAmount = (val) => {
                setDisplayAmount(val);
                let rawVal = parseFloat(val) || 0;
                let calculatedGrams = measureUnit === 'oz' ? rawVal * 28.3495 : rawVal;
                if (selectedFood) setSelectedFood({ ...selectedFood, userGrams: calculatedGrams });
            };

            const toggleUnit = () => {
                let nextUnit = measureUnit === 'g' ? 'oz' : measureUnit === 'oz' ? 'ml' : 'g';
                setMeasureUnit(nextUnit);
                let rawVal = parseFloat(displayAmount) || 0;
                let calculatedGrams = nextUnit === 'oz' ? rawVal * 28.3495 : rawVal;
                if (selectedFood) setSelectedFood({ ...selectedFood, userGrams: calculatedGrams });
            };

            // 5. Add to Log (Database)
            const addToLog = async () => {
                if(!selectedFood) return;
                const factor = selectedFood.userGrams / 100;
                
                const finalItem = {
                    name: selectedFood.name,
                    calories: Math.round(selectedFood.calories * factor),
                    protein: selectedFood.protein * factor,
                    carbs: selectedFood.carbs * factor,
                    fat: selectedFood.fat * factor,
                    grams: selectedFood.userGrams,
                    date: currentDate,
                    createdAt: window.fb.serverTimestamp()
                };

                await window.fb.addDoc(window.fb.collection(window.fb.db, "users", user.uid, "logs"), finalItem);
                setSelectedFood(null);
            };

            const deleteItem = async (id) => {
                if(confirm("Delete item?")) await window.fb.deleteDoc(window.fb.doc(window.fb.db, "users", user.uid, "logs", id));
            };

            // 6. Extras (Scanner, Date, PDF)
            const changeDate = (offset) => {
                const d = new Date(currentDate);
                d.setDate(d.getDate() + offset);
                setCurrentDate(d.toISOString().split('T')[0]);
                setSelectedFood(null);
            };

            useEffect(() => {
                if (isScanning) {
                    const html5QrCode = new Html5Qrcode("reader");
                    scannerRef.current = html5QrCode;
                    
                    // FIXED: Strict back camera constraint
                    const config = { 
                        fps: 10, 
                        qrbox: { width: 250, height: 250 }, 
                        videoConstraints: { 
                            facingMode: { exact: "environment" } 
                        } 
                    };
                    
                    // Fallback to simple constraint if 'exact' fails (e.g. laptop)
                    const fallbackConfig = { 
                         fps: 10, 
                         qrbox: { width: 250, height: 250 }, 
                         videoConstraints: { facingMode: "environment" } 
                    };

                    html5QrCode.start({ facingMode: { exact: "environment" } }, config, (decodedText) => { 
                        // SUCCESS
                        scannerRef.current.stop().then(() => {
                            scannerRef.current.clear();
                            setIsScanning(false);
                            setQuery(decodedText);
                            setTimeout(() => handleSearch(null, decodedText), 100);
                        });
                    }, (err) => {
                        // Scan fail (keep scanning)
                    }).catch(err => {
                        // Camera fail - try fallback
                        console.log("Primary camera failed, trying fallback...");
                        html5QrCode.start({ facingMode: "environment" }, fallbackConfig, (decodedText) => {
                             scannerRef.current.stop().then(() => {
                                scannerRef.current.clear();
                                setIsScanning(false);
                                setQuery(decodedText);
                                setTimeout(() => handleSearch(null, decodedText), 100);
                            });
                        }, () => {}).catch(err2 => {
                            console.error("Camera completely failed", err2);
                            setIsScanning(false);
                            setError("Camera not available.");
                        });
                    });
                }
                return () => { if(scannerRef.current && scannerRef.current.isScanning) scannerRef.current.stop().catch(e=>console.error(e)); }
            }, [isScanning]);

            const exportPDF = () => {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                const navy = '#0f172a';
                doc.setTextColor(navy); doc.setFontSize(18); doc.text("JOHN RUBEN SOLUTIONS", 20, 20);
                doc.setFontSize(12); doc.text(`Food Log: ${currentDate}`, 20, 30);
                if (dailyWeight) doc.text(`Weight: ${dailyWeight} lbs`, 20, 36);
                
                let y = 50;
                log.forEach(item => {
                    doc.setFontSize(10);
                    doc.text(`${item.name.substring(0, 50)}`, 20, y);
                    doc.text(`${Math.round(item.calories)} kcal | P:${Math.round(item.protein)}g C:${Math.round(item.carbs)}g F:${Math.round(item.fat)}g`, 20, y+5);
                    y+=15;
                    if(y > 270) { doc.addPage(); y = 20; }
                });
                
                const t = log.reduce((acc, item) => ({ cals: acc.cals + item.calories, pro: acc.pro + item.protein, carb: acc.carbs + item.carbs, fat: acc.fat + item.fat }), { cals: 0, pro: 0, carb: 0, fat: 0 });
                y += 5; doc.line(20, y, 190, y); y += 10;
                doc.setFontSize(12); doc.text(`TOTALS: ${Math.round(t.cals)} kcal`, 20, y);
                doc.save(`Log_${currentDate}.pdf`);
            };

            const totals = log.reduce((acc, item) => ({ cals: acc.cals + item.calories, pro: acc.pro + item.protein, carb: acc.carbs + item.carbs, fat: acc.fat + item.fat }), { cals: 0, pro: 0, carb: 0, fat: 0 });

            if (!user) return <AuthScreen />;

            return (
                <div className="max-w-3xl mx-auto px-4 pt-8">
                    {/* HEADER */}
                    <div className="flex justify-between items-center mb-6">
                        <h1 className="text-xl font-bold text-white">Food Tracker</h1>
                        <button onClick={() => window.fb.signOut(window.fb.auth)} className="text-xs text-slate-400 hover:text-white transition-colors">Sign Out</button>
                    </div>

                    {/* TARGETS DASHBOARD */}
                    {targets && (
                        <div className="bg-brand-card p-4 rounded-2xl mb-6 border border-slate-700 flex justify-between text-center">
                            <div><span className="text-[10px] text-slate-400 block uppercase">Calories</span><span className={`text-xl font-bold ${totals.cals > targets.calories ? 'text-red-400' : 'text-white'}`}>{Math.round(totals.cals)} / {targets.calories}</span></div>
                            <div><span className="text-[10px] text-brand-teal block uppercase">Protein</span><span className="text-sm text-slate-300 font-bold">{Math.round(totals.pro)} / {targets.protein}g</span></div>
                            <div><span className="text-[10px] text-brand-green block uppercase">Carbs</span><span className="text-sm text-slate-300 font-bold">{Math.round(totals.carb)} / {targets.carbs}g</span></div>
                        </div>
                    )}

                    {/* DATE & WEIGHT NAV */}
                    <div className="flex flex-col gap-3 bg-brand-card p-4 rounded-2xl mb-6 border border-slate-700">
                        <div className="flex justify-between items-center w-full">
                            <button onClick={() => changeDate(-1)} className="p-2 text-white bg-slate-700 rounded-lg">&lt;</button>
                            <span className="text-white font-bold">{currentDate}</span>
                            <button onClick={() => changeDate(1)} className="p-2 text-white bg-slate-700 rounded-lg">&gt;</button>
                        </div>
                        <div className="flex items-center justify-between bg-brand-input rounded-xl p-2 px-4 border border-slate-600">
                             <span className="text-xs font-bold text-slate-400 uppercase tracking-wider">Today's Weight:</span>
                             <div className="flex items-center">
                                <input type="number" value={dailyWeight} onChange={(e) => setDailyWeight(e.target.value)} onBlur={saveWeight} placeholder="0.0" className="bg-transparent text-white font-bold text-right w-16 focus:outline-none focus:border-b border-brand-green" />
                                <span className="text-xs text-brand-green font-bold ml-1">lbs</span>
                             </div>
                        </div>
                    </div>
                    
                    {/* SCANNER OVERLAY */}
                    {isScanning && (
                        <div className="fixed inset-0 z-[60] bg-black/90 flex flex-col items-center justify-center p-4">
                            <div className="bg-brand-card p-6 rounded-2xl w-full max-w-sm border border-slate-700 relative">
                                <h3 className="text-center font-bold text-white mb-4">Scan Barcode</h3>
                                <div id="reader" className="w-full bg-black rounded-xl overflow-hidden"></div>
                                <button onClick={() => setIsScanning(false)} className="absolute top-2 right-2 text-slate-400 p-2">Close</button>
                            </div>
                        </div>
                    )}

                    {/* SEARCH */}
                    <form onSubmit={handleSearch} className="flex gap-2 mb-6">
                        <div className="flex-1 relative">
                            <input type="text" value={query} onChange={e => setQuery(e.target.value)} placeholder="Search food or scan barcode..." className="w-full p-3 bg-brand-input rounded-xl text-white outline-none focus:border-brand-green border border-transparent pl-3 pr-10" />
                            <button type="button" onClick={()=>{setResultsList([]); setIsScanning(true)}} className="absolute right-2 top-1/2 -translate-y-1/2 text-slate-400 hover:text-brand-green p-2">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"/><circle cx="12" cy="13" r="3"/></svg>
                            </button>
                        </div>
                        <button type="submit" className="bg-brand-green text-brand-navy px-6 rounded-xl font-bold">{loading ? "..." : "Find"}</button>
                    </form>
                    {error && <p className="text-red-500 text-xs text-center mb-2">{error}</p>}

                    {/* SEARCH RESULTS */}
                    {resultsList.length > 0 && (
                        <div className="bg-brand-card rounded-xl border border-slate-700 mb-6 max-h-60 overflow-y-auto">
                            {resultsList.map(food => (
                                <div key={food.fdcId} onClick={() => selectFood(food)} className="p-3 border-b border-slate-700 text-slate-300 hover:bg-slate-700 cursor-pointer transition-colors">
                                    {food.description}
                                </div>
                            ))}
                        </div>
                    )}
                    
                    {/* SELECTED FOOD STAGING AREA */}
                    {selectedFood && (
                        <div className="bg-brand-card rounded-2xl border border-slate-700 p-4 mb-6 animate-fade">
                            <div className="flex justify-between items-start mb-4">
                                <h3 className="font-bold text-white text-lg flex-1 mr-2">{selectedFood.name}</h3>
                                <button onClick={() => setSelectedFood(null)} className="text-slate-500 hover:text-white">x</button>
                            </div>
                            
                            <div className="flex items-center justify-between mb-4 bg-brand-input rounded-xl p-2 border border-slate-600">
                                 <div className="flex items-center gap-2">
                                    <input type="number" value={displayAmount} onFocus={(e)=>setDisplayAmount('')} onChange={(e)=>updateAmount(e.target.value)} className="w-20 bg-transparent text-white font-bold text-2xl text-center focus:outline-none placeholder-slate-500" placeholder="0" />
                                    <button onClick={toggleUnit} className="px-3 py-1 bg-brand-card text-brand-green border border-brand-green rounded-lg font-bold text-xs uppercase hover:bg-brand-green hover:text-brand-navy transition-colors">{measureUnit}</button>
                                </div>
                                <div className="text-right">
                                    <span className="block text-2xl font-bold text-white">{Math.round(selectedFood.calories * (selectedFood.userGrams/100))}</span>
                                    <span className="text-[10px] text-slate-400 uppercase tracking-wider">Calories</span>
                                </div>
                            </div>
                            
                            <div className="grid grid-cols-3 gap-2 mb-4 text-center text-xs text-slate-300">
                                <div className="bg-slate-800 p-2 rounded-lg">Pro: {(selectedFood.protein * (selectedFood.userGrams/100)).toFixed(1)}g</div>
                                <div className="bg-slate-800 p-2 rounded-lg">Carb: {(selectedFood.carbs * (selectedFood.userGrams/100)).toFixed(1)}g</div>
                                <div className="bg-slate-800 p-2 rounded-lg">Fat: {(selectedFood.fat * (selectedFood.userGrams/100)).toFixed(1)}g</div>
                            </div>

                            <button onClick={addToLog} className="w-full py-3 bg-brand-green text-brand-navy font-bold rounded-xl hover:bg-white transition-colors">Add to Daily Log</button>
                        </div>
                    )}

                    {/* LOG */}
                    <div className="bg-brand-card rounded-2xl border border-slate-700 overflow-hidden">
                        <div className="p-4 border-b border-slate-700 flex justify-between items-center bg-slate-800/50">
                            <h3 className="font-bold text-white text-sm uppercase tracking-wide">Daily Log</h3>
                            <button onClick={exportPDF} className="text-xs font-bold text-brand-navy bg-brand-green px-3 py-1 rounded-full hover:bg-white transition-colors">Download PDF</button>
                        </div>
                        <div className="max-h-[400px] overflow-y-auto">
                            {log.map(item => (
                                <div key={item.id} className="p-4 border-b border-slate-700 flex justify-between items-center hover:bg-slate-700/30 transition-colors">
                                    <div className="flex-1 pr-2">
                                        <div className="text-white text-sm font-bold leading-tight">{item.name}</div>
                                        <div className="text-xs text-brand-teal mt-1">
                                            {Math.round(item.grams)}g <span className="text-slate-500">|</span> {Math.round(item.calories)} kcal <span className="text-slate-500">|</span> P: {Math.round(item.protein)}g
                                        </div>
                                    </div>
                                    <button onClick={() => deleteItem(item.id)} className="text-red-400 hover:text-red-300 p-2 transition-colors">x</button>
                                </div>
                            ))}
                            {log.length === 0 && <div className="p-8 text-center text-slate-500 text-sm">No foods logged for {currentDate}.</div>}
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
