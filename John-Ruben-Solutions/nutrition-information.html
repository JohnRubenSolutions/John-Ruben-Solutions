<!DOCTYPE html>
<html lang="en">
<head>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-J25PL1Z8SW"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-J25PL1Z8SW');
</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>John Ruben Solutions - Food Search</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@300;400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: { navy: '#003B5C', green: '#76BD22', teal: '#007A8C', bg: '#f0f4f8', text: '#334155' }
                    },
                    fontFamily: { sans: ['Comfortaa', 'cursive'] }
                }
            }
        }
    </script>

    <style>
        body { background-color: #f0f4f8; -webkit-tap-highlight-color: transparent; }
        .animate-fade { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Custom Scrollbar */
        .dropdown-scroll::-webkit-scrollbar { width: 4px; }
        .dropdown-scroll::-webkit-scrollbar-track { background: #f1f5f9; }
        .dropdown-scroll::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }

        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }

        /* Scanner specific styles */
        #reader { width: 100%; border-radius: 12px; overflow: hidden; }
        #reader video { object-fit: cover; border-radius: 12px; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        const API_KEY = '4FRpc4urF9W2UedPH6agara8y52PR0efkZRmoPvv'; 
        const PROXY = 'https://corsproxy.io/?';

        // --- SECONDARY DATA SOURCE (Fallback for Common Missing Items) ---
        // Values are per 100g. 
        const OMEGA_FALLBACK = {
            'chia':     { o3: 17.8, o6: 5.8 },
            'flax':     { o3: 22.8, o6: 5.9 },
            'walnut':   { o3: 9.1,  o6: 38.1 },
            'salmon':   { o3: 2.3,  o6: 0.1 },
            'mackerel': { o3: 5.1,  o6: 0.3 },
            'sardine':  { o3: 1.5,  o6: 3.5 },
            'hemp':     { o3: 10.0, o6: 27.0 },
            'canola':   { o3: 9.1,  o6: 18.6 },
            'olive':    { o3: 0.7,  o6: 9.7 },
            'avocado':  { o3: 0.1,  o6: 1.7 }
        };

        const Icons = {
            Search: () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>,
            Barcode: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 5v14"/><path d="M8 5v14"/><path d="M12 5v14"/><path d="M17 5v14"/><path d="M21 5v14"/></svg>,
            ArrowRight: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>,
            Back: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>,
            Star: () => <svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" viewBox="0 0 24 24" fill="currentColor" stroke="none"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2" /></svg>,
            Database: () => <svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/></svg>,
            Camera: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"/><circle cx="12" cy="13" r="3"/></svg>,
            Close: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>,
            Refresh: () => <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg>
        };

        const App = () => {
            const [query, setQuery] = useState("");
            const [resultsList, setResultsList] = useState([]); 
            const [selectedFood, setSelectedFood] = useState(null); 
            const [parsedWeight, setParsedWeight] = useState(null); 
            
            // New UI State
            const [measureUnit, setMeasureUnit] = useState('g'); // 'g', 'oz', 'ml'
            const [displayAmount, setDisplayAmount] = useState(100);

            const [loading, setLoading] = useState(false);
            const [error, setError] = useState("");
            
            // Scanner State
            const [isScanning, setIsScanning] = useState(false);
            const scannerRef = useRef(null);
            
            const dropdownRef = useRef(null);

            useEffect(() => {
                function handleClickOutside(event) {
                    if (dropdownRef.current && !dropdownRef.current.contains(event.target)) {
                        setResultsList([]); 
                    }
                }
                document.addEventListener("mousedown", handleClickOutside);
                document.addEventListener("touchstart", handleClickOutside);
                return () => {
                    document.removeEventListener("mousedown", handleClickOutside);
                    document.removeEventListener("touchstart", handleClickOutside);
                };
            }, [dropdownRef]);

            // --- SCANNER LOGIC (UPDATED FOR AUTOFOCUS) ---
            useEffect(() => {
                if (isScanning) {
                    const html5QrCode = new Html5Qrcode("reader");
                    scannerRef.current = html5QrCode;
                    
                    // Config with AutoFocus support
                    const config = { 
                        fps: 10, 
                        qrbox: { width: 250, height: 250 },
                        videoConstraints: {
                            facingMode: "environment",
                            focusMode: "continuous" // Attempt to force continuous focus
                        }
                    };

                    html5QrCode.start({ facingMode: "environment" }, config, (decodedText) => {
                        stopScanner(decodedText); 
                    }, (errorMessage) => {}).catch(err => {
                        console.error("Camera error", err);
                        setIsScanning(false);
                        setError("Camera access denied or not supported. Ensure you are using HTTPS.");
                    });
                }
                return () => {
                    if (scannerRef.current && scannerRef.current.isScanning) {
                        scannerRef.current.stop().catch(err => console.error("Failed to stop scanner", err));
                    }
                };
            }, [isScanning]);

            const startScanner = () => {
                setError("");
                setResultsList([]);
                setSelectedFood(null);
                setIsScanning(true);
            };

            const stopScanner = (foundCode = null) => {
                if (scannerRef.current) {
                    scannerRef.current.stop().then(() => {
                        scannerRef.current.clear();
                        setIsScanning(false);
                        if (foundCode) {
                            setQuery(foundCode);
                            handleSearch(null, foundCode);
                        }
                    }).catch(err => {
                        console.error("Failed to stop scanner", err);
                        setIsScanning(false);
                    });
                } else {
                    setIsScanning(false);
                }
            };

            // 1. PARSING LOGIC 
            const parseInput = (inputString) => {
                const weightRegex = /(\d+(\.\d+)?)\s*(g|gram|grams)\b/i;
                const match = inputString.match(weightRegex);
                let detectedWeight = null;
                let cleanTerm = inputString;
                if (match) {
                    detectedWeight = parseFloat(match[1]);
                    cleanTerm = inputString.replace(match[0], '').trim();
                }
                cleanTerm = cleanTerm.replace(/^\s*[-,\.]+\s*/, '').trim();
                return { term: cleanTerm, weight: detectedWeight };
            };

            // --- HELPER: Map OpenFoodFacts ---
            const mapOpenFoodFactsToUSDA = (product, userGrams) => {
                const nutriments = product.nutriments || {};
                const nutrients = [
                    { nutrientId: 1008, value: nutriments['energy-kcal_100g'] || 0 },
                    { nutrientId: 1003, value: nutriments['proteins_100g'] || 0 },
                    { nutrientId: 1004, value: nutriments['fat_100g'] || 0 },
                    { nutrientId: 1005, value: nutriments['carbohydrates_100g'] || 0 },
                    { nutrientId: 1079, value: nutriments['fiber_100g'] || 0 },
                    { nutrientId: 1272, value: nutriments['omega-3-fat_100g'] || 0 }, 
                    { nutrientId: 1269, value: nutriments['omega-6-fat_100g'] || 0 }
                ];
                return {
                    description: product.product_name || "Unknown Product",
                    foodNutrients: nutrients,
                    userGrams: userGrams,
                    dataType: 'OpenFoodFacts',
                    gtinUpc: product.code
                };
            };

            // 2. SEARCH LOGIC
            const handleSearch = async (e, overrideQuery = null) => {
                if (e) e.preventDefault();
                const effectiveQuery = overrideQuery || query;
                if (!effectiveQuery) return;

                setLoading(true);
                setError("");
                setResultsList([]);
                setSelectedFood(null);

                const { term, weight } = parseInput(effectiveQuery);
                const startingGrams = weight !== null ? weight : 100;
                setParsedWeight(weight); 
                
                // Reset unit defaults on new search
                setMeasureUnit('g');
                setDisplayAmount(startingGrams);

                const lowerTerm = term.toLowerCase();
                const firstWord = lowerTerm.split(' ')[0];
                const isBarcode = /^\d+$/.test(term);

                try {
                    let endpoint;
                    if (isBarcode) {
                        endpoint = `https://api.nal.usda.gov/fdc/v1/foods/search?api_key=${API_KEY}&query=${encodeURIComponent(term)}&pageSize=5&dataType=Branded,SR Legacy,Foundation`;
                    } else {
                        endpoint = `https://api.nal.usda.gov/fdc/v1/foods/search?api_key=${API_KEY}&query=${encodeURIComponent(term)}&pageSize=25&dataType=Foundation,SR Legacy,Branded`;
                    }

                    const res = await fetch(PROXY + encodeURIComponent(endpoint));
                    const data = await res.json();
                    let foundInUSDA = false;

                    if (data.foods && data.foods.length > 0) {
                        const validFoods = data.foods.filter(f => {
                            const hasCals = f.foodNutrients.some(n => (n.nutrientId === 1008 || n.nutrientId === 208) && n.value > 0);
                            return hasCals;
                        }).sort((a, b) => {
                            let typePriority = isBarcode 
                                ? { 'Branded': 3, 'Survey (FNDDS)': 2, 'SR Legacy': 1, 'Foundation': 0 }
                                : { 'Foundation': 3, 'SR Legacy': 2, 'Survey (FNDDS)': 1, 'Branded': 0 };
                            const scoreA = typePriority[a.dataType] || 0;
                            const scoreB = typePriority[b.dataType] || 0;
                            if (scoreA !== scoreB) return scoreB - scoreA; 
                            if (!isBarcode) {
                                const descA = a.description.toLowerCase();
                                const descB = b.description.toLowerCase();
                                if (descA.includes(lowerTerm) && !descB.includes(lowerTerm)) return -1;
                                if (!descA.includes(lowerTerm) && descB.includes(lowerTerm)) return 1;
                            }
                            return b.foodNutrients.length - a.foodNutrients.length; 
                        });

                        if (validFoods.length > 0) {
                            foundInUSDA = true;
                            if (isBarcode) {
                                await selectFood(validFoods[0], startingGrams);
                            } else {
                                setResultsList(validFoods.slice(0, 15)); 
                            }
                        }
                    } 
                    
                    if (!foundInUSDA && isBarcode) {
                        const offEndpoint = `https://world.openfoodfacts.org/api/v0/product/${term}.json`;
                        const offRes = await fetch(offEndpoint);
                        const offData = await offRes.json();
                        if (offData.status === 1) {
                            const mappedFood = mapOpenFoodFactsToUSDA(offData.product, startingGrams);
                            setSelectedFood(mappedFood);
                        } else {
                            setError("Product not found in USDA or OpenFoodFacts databases.");
                        }
                    } else if (!foundInUSDA) {
                        setError("No foods found.");
                    }
                } catch (err) {
                    console.error(err);
                    setError("Connection error. Please try again.");
                } finally {
                    setLoading(false);
                }
            };

            const selectFood = async (foodSummary, grams = 100) => {
                setResultsList([]); 
                setLoading(true);
                setError("");

                try {
                    const detailEndpoint = `https://api.nal.usda.gov/fdc/v1/food/${foodSummary.fdcId}?api_key=${API_KEY}`;
                    const res = await fetch(PROXY + encodeURIComponent(detailEndpoint));
                    const fullData = await res.json();

                    const normalizedNutrients = fullData.foodNutrients.map(n => ({
                        nutrientId: n.nutrient?.id || n.nutrientId, 
                        value: n.amount !== undefined ? n.amount : n.value
                    }));

                    const processedFood = {
                        ...fullData, 
                        description: fullData.description,
                        foodNutrients: normalizedNutrients,
                        userGrams: grams,
                        dataType: fullData.dataType || foodSummary.dataType 
                    };
                    setSelectedFood(processedFood);
                } catch (err) {
                    console.error(err);
                    setError("Could not retrieve detailed nutrient data.");
                } finally {
                    setLoading(false);
                }
                
                if (document.activeElement) {
                    document.activeElement.blur();
                }
            };

            // NEW: Logic to handle Display Input vs Real Grams
            const updateAmount = (val) => {
                setDisplayAmount(val); // Keep what user types
                
                let rawVal = parseFloat(val);
                if (isNaN(rawVal)) rawVal = 0;

                // Convert Display Value -> Grams for Macro Calc
                let calculatedGrams = rawVal;
                if (measureUnit === 'oz') {
                    calculatedGrams = rawVal * 28.3495;
                }
                // (ml is treated 1:1 with grams for simplicity in this context)

                if (selectedFood) {
                    setSelectedFood({ ...selectedFood, userGrams: calculatedGrams });
                }
            };

            // NEW: Toggle Units
            const toggleUnit = () => {
                const nextUnit = measureUnit === 'g' ? 'oz' : measureUnit === 'oz' ? 'ml' : 'g';
                setMeasureUnit(nextUnit);
                
                // Re-run the math with the CURRENT display amount but NEW unit
                let rawVal = parseFloat(displayAmount);
                if (isNaN(rawVal)) rawVal = 0;

                let calculatedGrams = rawVal;
                if (nextUnit === 'oz') calculatedGrams = rawVal * 28.3495;
                
                if (selectedFood) {
                    setSelectedFood({ ...selectedFood, userGrams: calculatedGrams });
                }
            };

            // 5. HELPER: Get Nutrients
            const getMacro = (food, ids, grams) => {
                if (!food || !food.foodNutrients) return 0;
                const nutrients = food.foodNutrients.filter(x => ids.includes(x.nutrientId));
                const totalPer100g = nutrients.reduce((sum, n) => sum + (n.value || 0), 0);
                return (totalPer100g * grams) / 100; 
            };

            // 6. HELPER: Hybrid Omega Calculation
            const getHybridOmegas = (food, grams) => {
                let o3 = getMacro(food, [1271, 1272, 1278, 1276], grams); 
                let o6 = getMacro(food, [1269, 1270], grams);
                let source = "USDA";
                if (food.dataType === 'OpenFoodFacts') source = "OpenFoodFacts";

                if (o3 < 0.01 && o6 < 0.01) {
                    const desc = food.description.toLowerCase();
                    for (const [key, data] of Object.entries(OMEGA_FALLBACK)) {
                        if (desc.includes(key)) {
                            o3 = (data.o3 * grams) / 100;
                            o6 = (data.o6 * grams) / 100;
                            source = "Secondary";
                            break;
                        }
                    }
                }
                return { o3, o6, source };
            };

            return (
                <div className="min-h-screen flex flex-col items-center pt-4 px-4 pb-20 font-sans text-brand-text">
                    
                    {/* BRAND HEADER */}
                    <div className="mb-4 text-center border-b-4 border-brand-green pb-3 px-8 mt-4">
                        <h1 className="text-2xl font-bold text-brand-navy tracking-tight">JOHN RUBEN</h1>
                        <p className="text-brand-green text-xs font-bold uppercase tracking-[0.2em] mt-1">Solutions</p>
                    </div>

                    <div className="text-center mb-4">
                         <h2 className="text-brand-teal text-xs font-bold uppercase tracking-widest">Precision Food Search</h2>
                    </div>

                    {/* SCANNER OVERLAY */}
                    {isScanning && (
                        <div className="fixed inset-0 z-[60] bg-black bg-opacity-90 flex flex-col items-center justify-center p-4">
                            <div className="bg-white p-4 rounded-2xl w-full max-w-sm shadow-2xl relative">
                                <h3 className="text-center font-bold text-brand-navy mb-4">Scan Product Barcode</h3>
                                <div id="reader" className="w-full bg-black"></div>
                                <button onClick={() => stopScanner()} className="absolute top-2 right-2 text-slate-400 hover:text-red-500 p-2">
                                    <Icons.Close />
                                </button>
                                <p className="text-center text-xs text-slate-400 mt-4">Point camera at barcode.</p>
                            </div>
                        </div>
                    )}

                    {/* SEARCH AREA */}
                    <div className="w-full max-w-xl relative z-50" ref={dropdownRef}>
                        <form onSubmit={handleSearch} className="relative flex shadow-lg rounded-xl bg-white overflow-hidden border-2 border-transparent focus-within:border-brand-green transition-colors">
                            <input 
                                type="text" 
                                className="flex-1 p-3 pl-10 border-none focus:outline-none text-base text-brand-navy placeholder-slate-400 bg-transparent appearance-none min-w-0"
                                placeholder="Scan Product or Search..."
                                value={query}
                                onChange={(e) => setQuery(e.target.value)}
                                autoComplete="off"
                            />
                            <div className="absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400 flex items-center gap-2">
                                <Icons.Search />
                            </div>
                            <button type="button" onClick={startScanner} className="p-2 mr-0 text-slate-400 hover:text-brand-teal active:scale-95 transition-transform" title="Scan Barcode">
                                <Icons.Camera />
                            </button>
                            <button type="submit" disabled={loading} className="px-4 sm:px-6 bg-brand-navy text-white font-bold active:bg-brand-teal transition-colors disabled:opacity-70 whitespace-nowrap">
                                {loading ? "..." : "Find"}
                            </button>
                        </form>

                        {/* DROPDOWN MENU */}
                        {resultsList.length > 0 && (
                            <div className="absolute top-full left-0 right-0 mt-2 bg-white rounded-xl shadow-2xl border border-slate-200 overflow-hidden animate-fade z-50">
                                <div className="bg-slate-50 px-4 py-3 text-xs font-bold text-slate-500 uppercase tracking-wider border-b border-slate-200 flex justify-between">
                                    <span>Tap to select:</span>
                                    <span className="text-[10px] text-brand-green flex items-center gap-1"><Icons.Star/> = Verified Data</span>
                                </div>
                                <div className="max-h-[40vh] overflow-y-auto dropdown-scroll overscroll-contain">
                                    {resultsList.map((food, idx) => {
                                        const isFoundation = food.dataType === 'Foundation';
                                        return (
                                            <div key={idx} onClick={() => selectFood(food)} className={`px-4 py-4 border-b border-slate-100 cursor-pointer flex justify-between items-center group transition-colors ${isFoundation ? 'bg-green-50/50 hover:bg-green-50' : 'hover:bg-blue-50'}`}>
                                                <div className="flex flex-col items-start overflow-hidden">
                                                    <div className="flex items-center gap-2 w-full">
                                                        <span className="font-bold text-brand-navy text-sm leading-snug truncate">{food.description}</span>
                                                        {isFoundation && (<span className="shrink-0 text-[9px] bg-brand-green text-white px-1.5 py-0.5 rounded-full font-bold flex items-center gap-1"><Icons.Star /> Best</span>)}
                                                    </div>
                                                    <span className="text-[10px] text-slate-400 mt-1 uppercase tracking-wider">
                                                        {food.dataType} {food.gtinUpc ? `| UPC: ${food.gtinUpc}` : ''}
                                                    </span>
                                                </div>
                                                <span className="text-slate-300 ml-3 shrink-0"><Icons.ArrowRight /></span>
                                            </div>
                                        )
                                    })}
                                </div>
                            </div>
                        )}
                        {error && <div className="mt-3 p-3 bg-red-50 text-red-600 text-sm text-center rounded-xl border border-red-100 font-bold">{error}</div>}
                    </div>

                    {/* SELECTED RESULT CARD */}
                    {selectedFood && !loading && (() => {
                        const grams = selectedFood.userGrams;
                        const cal = Math.round(getMacro(selectedFood, [1008, 208], grams));
                        const pro = getMacro(selectedFood, [1003, 203], grams).toFixed(1);
                        const fat = getMacro(selectedFood, [1004, 204], grams).toFixed(1);
                        const carb = getMacro(selectedFood, [1005, 205], grams).toFixed(1);
                        const fib = getMacro(selectedFood, [1079, 291], grams).toFixed(1);
                        const { o3, o6, source } = getHybridOmegas(selectedFood, grams);

                        return (
                            <div className="w-full max-w-xl mt-6 animate-fade pb-10">
                                <div className="bg-white rounded-3xl shadow-md border border-slate-100 overflow-hidden">
                                    
                                    {/* Header & Inputs */}
                                    <div className="bg-brand-navy px-6 py-5 flex flex-row justify-between items-start gap-4">
                                        <div className="flex-1">
                                            <h3 className="font-bold text-white text-lg leading-tight mb-1">
                                                {selectedFood.description}
                                            </h3>
                                            <div className="flex gap-2">
                                                {selectedFood.dataType === 'Foundation' && <span className="text-[9px] text-brand-green font-bold uppercase tracking-widest block">Lab Tested</span>}
                                                {selectedFood.dataType === 'OpenFoodFacts' && <span className="text-[9px] text-brand-teal font-bold uppercase tracking-widest block">OpenFoodFacts</span>}
                                            </div>
                                        </div>
                                        
                                        {/* GEN Z UI: Big Pill Input */}
                                        <div className="flex items-center bg-white/10 backdrop-blur-sm rounded-2xl p-1.5 border border-white/20 shrink-0 shadow-inner">
                                            <input 
                                                type="number" 
                                                value={displayAmount}
                                                onFocus={(e) => setDisplayAmount('')} 
                                                onChange={(e) => updateAmount(e.target.value)}
                                                className="w-16 bg-transparent text-white font-bold text-2xl text-center focus:outline-none placeholder-white/30"
                                                placeholder="0"
                                            />
                                            {/* Tap to Cycle Units */}
                                            <button 
                                                onClick={toggleUnit}
                                                className="h-10 px-3 bg-white text-brand-navy rounded-xl font-bold text-sm uppercase tracking-wide hover:bg-brand-green hover:text-white transition-colors shadow-sm"
                                            >
                                                {measureUnit}
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <div className="p-5">
                                        <div className="grid grid-cols-4 sm:grid-cols-7 gap-2 mb-4 text-center">
                                            <div className="col-span-1 flex flex-col justify-center">
                                                <span className="text-[9px] font-bold text-slate-400 uppercase tracking-wider mb-1">Cals</span>
                                                <span className="text-xl font-bold text-brand-navy">{cal}</span>
                                            </div>
                                            <div className="bg-blue-50 rounded-xl p-2 flex flex-col justify-center">
                                                <span className="block text-brand-navy font-bold text-md leading-none">{pro}</span>
                                                <span className="text-[8px] text-brand-teal uppercase font-bold tracking-wider mt-1">Prot</span>
                                            </div>
                                            <div className="bg-green-50 rounded-xl p-2 flex flex-col justify-center">
                                                <span className="block text-brand-navy font-bold text-md leading-none">{carb}</span>
                                                <span className="text-[8px] text-brand-teal uppercase font-bold tracking-wider mt-1">Carb</span>
                                            </div>
                                            <div className="bg-yellow-50 rounded-xl p-2 flex flex-col justify-center">
                                                <span className="block text-brand-navy font-bold text-md leading-none">{fat}</span>
                                                <span className="text-[8px] text-brand-teal uppercase font-bold tracking-wider mt-1">Fat</span>
                                            </div>
                                            <div className="bg-slate-100 rounded-xl p-2 flex flex-col justify-center">
                                                <span className="block text-brand-navy font-bold text-md leading-none">{fib}</span>
                                                <span className="text-[8px] text-brand-teal uppercase font-bold tracking-wider mt-1">Fiber</span>
                                            </div>
                                            <div className="bg-sky-100 rounded-xl p-2 flex flex-col justify-center border border-sky-200">
                                                <span className="block text-sky-900 font-bold text-md leading-none">{o3.toFixed(1)}</span>
                                                <span className="text-[8px] text-sky-700 uppercase font-bold tracking-wider mt-1">Ω-3</span>
                                            </div>
                                            <div className="bg-orange-50 rounded-xl p-2 flex flex-col justify-center border border-orange-200">
                                                <span className="block text-orange-900 font-bold text-md leading-none">{o6.toFixed(1)}</span>
                                                <span className="text-[8px] text-orange-700 uppercase font-bold tracking-wider mt-1">Ω-6</span>
                                            </div>
                                        </div>

                                        <div className="flex justify-end mt-4 pt-3 border-t border-slate-100">
                                            <span className={`text-[8px] px-1.5 py-0.5 rounded border uppercase font-bold flex items-center gap-1 ${
                                                source === 'Secondary' ? 'bg-purple-50 text-purple-700 border-purple-200' 
                                                : source === 'OpenFoodFacts' ? 'bg-orange-50 text-orange-700 border-orange-200'
                                                : 'bg-slate-100 text-slate-500 border-slate-200'
                                            }`}>
                                                <Icons.Database /> Source: {source === 'Secondary' ? 'Secondary DB' : source}
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        );
                    })()}

                    <div className="mt-8 text-center px-6 pb-8">
                        <p className="text-[10px] text-slate-400">
                            Data provided by USDA FoodData Central & OpenFoodFacts.<br/>
                            Some Omega values estimated via secondary sources.
                        </p>
                        <a href="https://johnrubensolutions.com" className="inline-block mt-6 px-6 py-2.5 bg-white border border-slate-300 text-slate-500 font-bold rounded-full text-xs hover:bg-slate-50 hover:text-brand-navy transition-colors shadow-sm">
                            Return to Home Page
                        </a>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
