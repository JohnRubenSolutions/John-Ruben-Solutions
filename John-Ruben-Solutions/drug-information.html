<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>John Ruben Solutions - Drug Intelligence</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: { 
                            navy: '#0f172a', // Darker, punchier navy
                            green: '#84cc16', // Lime green pop
                            teal: '#06b6d4', 
                            bg: '#f8fafc', 
                            text: '#334155',
                            accent: '#6366f1' // Indigo for UI accents
                        }
                    },
                    fontFamily: { sans: ['"Plus Jakarta Sans"', 'sans-serif'] },
                    boxShadow: {
                        'soft': '0 20px 40px -15px rgba(0, 0, 0, 0.05)',
                        'glow': '0 0 20px rgba(132, 204, 22, 0.3)'
                    }
                }
            }
        }
    </script>

    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        body { background-color: #f8fafc; }
        .animate-up { animation: slideUp 0.5s cubic-bezier(0.16, 1, 0.3, 1); }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Modern scrollbar */
        .custom-scroll::-webkit-scrollbar { width: 6px; }
        .custom-scroll::-webkit-scrollbar-track { background: transparent; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Modern Icon Set
        const Icons = {
            Search: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>,
            Scale: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><path d="m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z"/><path d="m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z"/><path d="M7 21h10"/><path d="M12 3v18"/><path d="M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2"/></svg>,
            Bolt: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/></svg>,
            Muscle: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><path d="M12 12c-3 0-4-3-4-3s-1-4 4-4 4 4 4 4-1 3-4 3z"/><path d="M12 12c3 0 4 3 4 3s1 4-4 4-4-4-4-4 1-3 4-3z"/><path d="M6.5 12c0-3.5 2.5-6 5.5-6s5.5 2.5 5.5 6"/><path d="M6 12h12"/></svg>,
            Back: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>,
            ChevronDown: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><path d="m6 9 6 6 6-6"/></svg>,
            Warning: () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></svg>
        };

        const App = () => {
            const [query, setQuery] = useState("");
            const [resultsList, setResultsList] = useState([]);
            const [selectedResult, setSelectedResult] = useState(null);
            const [showDropdown, setShowDropdown] = useState(false);
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState("");
            const [isMoaExpanded, setIsMoaExpanded] = useState(false);
            const dropdownRef = useRef(null);

            useEffect(() => {
                function handleClickOutside(event) {
                    if (dropdownRef.current && !dropdownRef.current.contains(event.target)) {
                        setShowDropdown(false);
                    }
                }
                document.addEventListener("mousedown", handleClickOutside);
                return () => document.removeEventListener("mousedown", handleClickOutside);
            }, [dropdownRef]);

            const analyzeData = (drugData) => {
                const name = (drugData.openfda.brand_name ? drugData.openfda.brand_name[0] : "").toLowerCase();
                const generic = (drugData.openfda.generic_name ? drugData.openfda.generic_name[0] : "").toLowerCase();
                
                let mechanism = "Mechanism of action data not available in standard FDA summary.";
                if (drugData.mechanism_of_action && drugData.mechanism_of_action.length > 0) {
                    mechanism = drugData.mechanism_of_action[0];
                    mechanism = mechanism.replace(/Mechanism of Action/i, "").trim();
                }

                // --- SPECIAL CASE: OZEMPIC (UNCHANGED) ---
                if (name.includes("ozempic") || name.includes("wegovy") || generic.includes("semaglutide")) {
                    return {
                        mechanism: mechanism,
                        weightAlert: {
                            type: "Weight Loss & Muscle Risk",
                            severity: "high",
                            icon: <Icons.Scale />,
                            msg: "Clinical data indicates potential for significant weight reduction.",
                            theme: "purple" 
                        },
                        muscleWarning: {
                            show: true,
                            title: "⚠️ Muscle Mass Alert",
                            msg: "GLP-1 agonists (like Ozempic) can cause rapid loss of lean muscle mass alongside fat. To avoid 'skinny fat' composition and metabolic slowdown, it is highly recommended to prioritize high protein intake (1.6g/kg) and consistent resistance training (weight lifting) while on this medication."
                        }
                    };
                }

                // --- GENERAL LOGIC EXPANSION ---
                const textToCheck = [
                    ...(drugData.adverse_reactions || []),
                    ...(drugData.warnings || []),
                    ...(drugData.boxed_warning || []),
                    ...(drugData.clinical_studies || []),
                    ...(drugData.mechanism_of_action || [])
                ].join(" ").toLowerCase();

                // 1. Weight Gain Keywords (Expanded)
                const gainKeywords = [
                    "weight gain", "increase in weight", "weight increased", "fluid retention", 
                    "increased appetite", "hyperphagia", "edema", "swelling", "obesity", 
                    "body mass index increased", "metabolic syndrome", "bloating", "fat redistribution"
                ];

                // 2. Weight Loss Keywords (Expanded)
                const lossKeywords = [
                    "weight loss", "decrease in weight", "decreased weight", "decreased appetite", 
                    "anorexia", "cachexia", "body mass index decreased", "wasting", 
                    "failure to thrive", "loss of appetite"
                ];

                // 3. Metabolic Impact Keywords (New Category)
                const metabolicKeywords = [
                    "hyperglycemia", "hypoglycemia", "diabetes", "insulin resistance", 
                    "dyslipidemia", "hyperlipidemia", "cholesterol increased", "triglycerides increased",
                    "metabolic acidosis", "metabolic alkalosis", "thyroid function"
                ];

                const hasGain = gainKeywords.some(k => textToCheck.includes(k));
                const hasLoss = lossKeywords.some(k => textToCheck.includes(k));
                const hasMetabolic = metabolicKeywords.some(k => textToCheck.includes(k));

                let weightAlert = null;

                if (hasGain) {
                    weightAlert = {
                        type: "Potential Weight Gain",
                        severity: "high",
                        icon: <Icons.Scale />,
                        msg: "FDA label references weight gain, increased appetite, fluid retention, or edema.",
                        theme: "orange"
                    };
                } else if (hasLoss) {
                    weightAlert = {
                        type: "Potential Weight Loss",
                        severity: "high",
                        icon: <Icons.Scale />,
                        msg: "FDA label references weight loss, appetite suppression, or anorexia.",
                        theme: "blue"
                    };
                }

                // New Metabolic Alert Logic (Appends to weight alert or creates new one)
                let metabolicAlert = null;
                if (hasMetabolic) {
                    metabolicAlert = {
                        type: "Metabolic Impact",
                        msg: "This drug contains warnings regarding blood sugar (glucose), lipids (cholesterol), or thyroid function."
                    };
                }

                return { mechanism, weightAlert, metabolicAlert, muscleWarning: { show: false } };
            };

            const handleSearch = async (e) => {
                e.preventDefault();
                if (!query) return;
                setLoading(true);
                setError("");
                setSelectedResult(null);
                setShowDropdown(false);
                setIsMoaExpanded(false);

                try {
                    const response = await fetch(`https://api.fda.gov/drug/label.json?search=openfda.brand_name:"${query}"&limit=10`);
                    const data = await response.json();

                    if (data.error || !data.results) {
                        setError("No meds found. Check spelling?");
                        setResultsList([]);
                    } else {
                        const validResults = data.results.filter(r => r.openfda && r.openfda.brand_name);
                        if(validResults.length === 0) {
                             setError("No valid brand names found.");
                        } else {
                             setResultsList(validResults);
                             setShowDropdown(true);
                        }
                    }
                } catch (err) {
                    setError("FDA Database offline or connection issue.");
                } finally {
                    setLoading(false);
                }
            };

            const selectDrug = (drugData) => {
                const analysis = analyzeData(drugData);
                setSelectedResult({
                    name: drugData.openfda.brand_name[0],
                    generic: drugData.openfda.generic_name ? drugData.openfda.generic_name[0] : "Generic not listed",
                    manufacturer: drugData.openfda.manufacturer_name ? drugData.openfda.manufacturer_name[0] : "Unknown",
                    ...analysis
                });
                setShowDropdown(false);
                setQuery(""); 
                setIsMoaExpanded(false);
            };

            // Dynamic Theme Helpers
            const getThemeClasses = (theme) => {
                if (theme === 'purple') return "bg-purple-50 border-purple-200 text-purple-900";
                if (theme === 'orange') return "bg-orange-50 border-orange-200 text-orange-900";
                if (theme === 'blue') return "bg-sky-50 border-sky-200 text-sky-900";
                return "bg-slate-50 border-slate-200 text-slate-900";
            };

            return (
                <div className="min-h-screen flex flex-col items-center pt-8 px-4 pb-20 font-sans text-brand-text bg-[#f8fafc]">
                    
                    {/* TOP NAV / BACK */}
                    <div className="w-full max-w-xl mb-8 flex justify-between items-center">
                        <a href="https://www.johnrubensolutions.com/home" className="inline-flex items-center gap-2 text-slate-500 hover:text-brand-navy font-bold text-sm transition-colors bg-white px-4 py-2 rounded-full shadow-sm hover:shadow-md">
                            <Icons.Back /> Back
                        </a>
                        <div className="text-right">
                             <h1 className="text-xl font-extrabold text-brand-navy tracking-tight leading-none">JOHN RUBEN</h1>
                             <p className="text-[10px] font-bold text-brand-green uppercase tracking-[0.25em]">Solutions</p>
                        </div>
                    </div>

                    {/* HERO TEXT */}
                    <div className="text-center mb-8 animate-up">
                         <h2 className="text-4xl font-extrabold text-brand-navy mb-2">Drug Intelligence</h2>
                         <p className="text-slate-500 font-medium">Check your meds for weight & metabolic impacts.</p>
                    </div>

                    {/* SEARCH BAR (Floating Glass Effect) */}
                    <div className="w-full max-w-xl relative z-20 mb-10" ref={dropdownRef}>
                        <form onSubmit={handleSearch} className="relative group">
                            <div className="absolute inset-0 bg-brand-green opacity-20 blur-xl rounded-3xl group-hover:opacity-30 transition-opacity"></div>
                            <div className="relative bg-white rounded-3xl shadow-xl transition-all border-2 border-transparent focus-within:border-brand-green flex items-center overflow-hidden">
                                <div className="pl-5 text-slate-400">
                                    <Icons.Search />
                                </div>
                                <input 
                                    type="text" 
                                    className="w-full p-5 text-lg font-bold text-brand-navy placeholder-slate-400 bg-transparent focus:outline-none"
                                    placeholder="Search drug (e.g. Metformin)..."
                                    value={query}
                                    onChange={(e) => setQuery(e.target.value)}
                                    autoComplete="off"
                                />
                                <button 
                                    type="submit" 
                                    disabled={loading}
                                    className="mr-2 px-6 py-3 bg-brand-navy text-white rounded-2xl font-bold hover:bg-brand-green transition-colors disabled:opacity-70"
                                >
                                    {loading ? "Scanning..." : "Go"}
                                </button>
                            </div>
                        </form>

                        {/* DROPDOWN RESULTS */}
                        {showDropdown && resultsList.length > 0 && (
                            <div className="absolute top-full left-0 right-0 mt-4 bg-white rounded-3xl shadow-2xl border border-slate-100 overflow-hidden z-30 animate-up">
                                <div className="max-h-72 overflow-y-auto custom-scroll p-2">
                                    {resultsList.map((drug, idx) => (
                                        <div 
                                            key={idx}
                                            onClick={() => selectDrug(drug)}
                                            className="p-4 rounded-2xl hover:bg-slate-50 cursor-pointer transition-colors group mb-1 last:mb-0"
                                        >
                                            <div className="font-extrabold text-brand-navy text-lg group-hover:text-brand-green transition-colors">
                                                {drug.openfda.brand_name[0]}
                                            </div>
                                            <div className="text-xs font-semibold text-slate-400 uppercase mt-1">
                                                {drug.openfda.generic_name ? drug.openfda.generic_name[0].slice(0, 45) + (drug.openfda.generic_name[0].length > 45 ? "..." : "") : "N/A"}
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}
                        {error && <div className="mt-4 p-4 bg-red-50 text-red-600 font-bold text-center rounded-2xl animate-up">{error}</div>}
                    </div>

                    {/* RESULT CARD */}
                    {selectedResult && (
                        <div className="w-full max-w-xl animate-up">
                            <div className="bg-white rounded-[2rem] shadow-soft border border-white overflow-hidden">
                                
                                {/* Header Block */}
                                <div className="bg-brand-navy p-8 text-white relative overflow-hidden">
                                    <div className="absolute top-0 right-0 w-32 h-32 bg-brand-teal rounded-full blur-[60px] opacity-20"></div>
                                    <div className="relative z-10">
                                        <div className="inline-flex items-center gap-1 bg-white/10 backdrop-blur-md border border-white/20 text-white text-[10px] font-extrabold px-3 py-1 rounded-full uppercase tracking-wider mb-4">
                                            FDA Label Data
                                        </div>
                                        <h2 className="text-3xl font-extrabold mb-1">{selectedResult.name}</h2>
                                        <p className="text-brand-teal font-medium opacity-90">{selectedResult.generic}</p>
                                        <p className="text-xs text-slate-400 mt-4 font-bold uppercase tracking-wider opacity-60">Mfr: {selectedResult.manufacturer}</p>
                                    </div>
                                </div>

                                <div className="p-6 md:p-8 space-y-6">
                                    
                                    {/* 1. MECHANISM (Accordion style) */}
                                    <div>
                                        <div className="flex items-center gap-2 mb-3">
                                            <div className="text-brand-navy"><Icons.Bolt /></div>
                                            <h3 className="font-extrabold text-sm text-brand-navy uppercase tracking-wide">How it works</h3>
                                        </div>
                                        <div className="bg-slate-50 p-5 rounded-3xl border border-slate-100">
                                            <div className="text-sm text-slate-600 leading-relaxed font-medium">
                                                {isMoaExpanded ? selectedResult.mechanism : (
                                                    selectedResult.mechanism.length > 200 
                                                    ? selectedResult.mechanism.substring(0, 200) + "..." 
                                                    : selectedResult.mechanism
                                                )}
                                            </div>
                                            {selectedResult.mechanism.length > 200 && (
                                                <button 
                                                    onClick={() => setIsMoaExpanded(!isMoaExpanded)}
                                                    className="mt-3 text-xs font-extrabold text-brand-teal hover:text-brand-navy flex items-center gap-1"
                                                >
                                                    {isMoaExpanded ? "Show Less" : "Read Full Mechanism"}
                                                </button>
                                            )}
                                        </div>
                                    </div>

                                    {/* 2. THE VIBE CHECK (Weight Alert) */}
                                    <div>
                                        <h3 className="font-extrabold text-sm text-brand-navy uppercase tracking-wide mb-3">The Vibe Check</h3>
                                        {selectedResult.weightAlert ? (
                                            <div className={`p-6 rounded-3xl border-2 ${getThemeClasses(selectedResult.weightAlert.theme)}`}>
                                                <div className="flex items-start gap-4">
                                                    <div className="mt-1 p-2 bg-white/50 rounded-full">{selectedResult.weightAlert.icon}</div>
                                                    <div>
                                                        <h4 className="font-extrabold text-base mb-1">{selectedResult.weightAlert.type}</h4>
                                                        <p className="text-sm font-medium opacity-90 leading-relaxed">
                                                            {selectedResult.weightAlert.msg}
                                                        </p>
                                                    </div>
                                                </div>
                                            </div>
                                        ) : (
                                            <div className="p-6 rounded-3xl border-2 border-slate-100 bg-slate-50 text-center">
                                                <div className="font-extrabold text-slate-700">Weight Neutral / No Data</div>
                                                <p className="text-slate-500 text-xs mt-1 font-medium">No specific weight keywords found in FDA label.</p>
                                            </div>
                                        )}
                                    </div>

                                    {/* 3. METABOLIC ALERT (New) */}
                                    {selectedResult.metabolicAlert && (
                                        <div className="p-4 rounded-2xl bg-indigo-50 border border-indigo-100 flex items-start gap-3">
                                            <div className="text-indigo-500 mt-0.5"><Icons.Warning /></div>
                                            <div>
                                                <h4 className="text-xs font-extrabold text-indigo-900 uppercase tracking-wide mb-1">Metabolic Impact Detected</h4>
                                                <p className="text-xs text-indigo-800 font-medium leading-relaxed">
                                                    {selectedResult.metabolicAlert.msg}
                                                </p>
                                            </div>
                                        </div>
                                    )}

                                    {/* 4. MUSCLE WARNING (Specific to GLP-1) */}
                                    {selectedResult.muscleWarning.show && (
                                        <div className="bg-gradient-to-br from-purple-900 to-indigo-900 text-white rounded-3xl p-6 shadow-xl relative overflow-hidden">
                                            <div className="absolute top-0 right-0 w-32 h-32 bg-white opacity-5 rounded-full blur-2xl"></div>
                                            <div className="relative z-10">
                                                <div className="flex items-center gap-2 mb-3 text-purple-200">
                                                    <Icons.Muscle />
                                                    <span className="text-xs font-bold uppercase tracking-widest">Gym Bro Note</span>
                                                </div>
                                                <h3 className="font-extrabold text-lg mb-2 text-white">
                                                    {selectedResult.muscleWarning.title}
                                                </h3>
                                                <p className="text-sm font-medium text-purple-100 leading-relaxed">
                                                    {selectedResult.muscleWarning.msg}
                                                </p>
                                            </div>
                                        </div>
                                    )}

                                </div>

                                <div className="bg-slate-50 border-t border-slate-100 px-8 py-5">
                                    <p className="text-[10px] text-slate-400 font-bold leading-relaxed text-center uppercase tracking-wide">
                                        Data Source: openFDA. Not Medical Advice. Consult your doctor.
                                    </p>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>